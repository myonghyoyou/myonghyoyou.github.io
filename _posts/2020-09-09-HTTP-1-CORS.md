---
title: HTTP 1. CORS(Cross Origin Resource Sharing)
tags: HTTP
article_header:
  type: cover
  image: 
      src: 
---

# HTTP : CORS에 대하여

### 개요
HTTP 요청은 기본적으로 Cross-Site HTTP Request가 가능하다. <img> 태그나 <link> 태그로 다른 도메인의 이미지 파일과 CSS를 가져오거나 \<script> 태그로 JS 라이브러리 또한 가져올 수 있다.

하지만 스크립트에서 생성된 Cross-Site HTTP Request는 (라이브러리 호출을 제외한) Same Origin Policy를 적용 받기 때문에 Cross-Site HTTp Request가 불가하다.
Same Origin Policy는 출처가 동일해야한다는 정책으로 프로토콜, 호스트명, 포트가 같아야지만 요청에 대해 응답을 받을 수 있다.

Ajax가 널리 사용되며 스크립트에서 생성되는 XMLHttpRequest에 대해서도 Cross-Site HTTP Request가 가능하게 해달라는 요구가 늘어났고 그에 따라 W3C에서는 CORS라는 이름의 권고안을 낸다.

<br>

---

### COR 요청의 종류


<table>
  <th>COR 요청</th>
  <th>설명</th>
  <tr>
    <td> Simple Request </td>
    <td>아래의 3가지 조건을 모두 만족하면 Simple Request이다. <ul>&nbsp;&nbsp;<li>GET, HEAD, POST 중 한 가지 방식을 사용해야 함 </li> &nbsp;&nbsp; <li>POST 방식일 경우 Content-type이 아래 셋 중의 하나여야 함 </li> <br> &nbsp;&nbsp;&nbsp;&nbsp;application/x-www-form-urlencoded <br> &nbsp;&nbsp;&nbsp;&nbsp;multipart/form-data <br> &nbsp;&nbsp;&nbsp;&nbsp;text/plain <br> &nbsp;&nbsp;<li>커스텀 헤더를 전송하지 말아야함</li></ul>서버에 1번 요청하고, 서버도 1번 회신한다.     
    </td>
  </tr>
  
  <tr>
    <td> Preflight Request </td>
    <td> Simple Request 조건에 해당하지 않으면 브라우저는 Preflight Request 방식으로 요청. <br><br> Preflight Request는 다양한 메소드와 Content-type 그리고 커스텀 헤더를 사용 가능. <br><br> Preflight Request는 예비 요청과 본 요청으로 나뉘어 전송. <br> 예비 요청 -> 예비 요청에 대한 응답 -> 본 요청 -> 본 요청에 대한 응답 <br> 
    </td>
  </tr>
  
  <tr>
    <td>Request with Credentials</td>
    <td> HTTP Cookie와 HTTP Authentication 정보를 인식할 수 있게 해주는 요청 <br><br> 요청 시 Xhr.withCredentials = true를 지정해서 Credential 요청을 보낼 수 있고, 서버는 Response Header에 반드시 Access-Control-Allow-Credentials: true를 포함시켜야 함. <br> Access-Control-Allow-Origin 헤더의 값에는 *가 오면 안되고 구체적인 도메인이 와야 함. 
    </td>
  </tr>
  
  <tr>
    <td> Request without Crednetials </td>
    <td> 
      CORS 요청은 기본적으로 Non-Credential 요청이므로, xhr.withCredentials = true를 지정하지 않으면 Non-Credential 요청이다. 
    </td>
  </tr>
    
</table>

<br>

---

### CORS 관련 HTTP Response Headers
서버에서 CORS 요청을 처리할 때 지정하는 헤더

#### Access-Control-Allow-Origin
Access-Control-Allow-Origin 헤더의 값으로 지정된 도메인으로부터의 요청만 서버의 리소스에 접근할 수 있게 한다.
```
Access-Control-Allow-Origin : <origin> | *
```
`<origin>`에는 요청 도메인의 URI를 지정한다. 모든 도메인으로부터의 서버 리소스 접근을 허용하려면 `*`을 지정한다. Requeset with Credential의 경우 `*`을 사용할 수 없다. <br>
또한 Access-Control-Allow-Origin 옵션은 1개의 도메인만 작성할 수 있게 되어있다.

#### Access-Control-Expose-Headers
기본적으로 브라우저에게 노출이 되지않지만, 브라우저 측에서 접근할 수 있게 허용해주는 헤더를 지정한다.<br><br>
기본적으로 브라우저에 노출이 되는 HTTP Response Header는 아래의 6가지 밖에 없다.
<ul>
<li>Cache-Control</li>
<li>Content-Language</li>
<li>Content-Type</li>
<li>Expires</li>
<li>Last-Modified</li>
<li>Pragma</li>
</ul>
다음과 같이 `Access-Control-Expose-Headers`를 Response Header에 지정하여 회신하면 브라우저 측에서 커스텀 헤더를 포함하여, 기본적으로는 접근할 수 없었던 Content-Length 헤더 정보도 알 수 있게 된다.
<br><br>

```
Access-Control-Expose-Headers : Content-Length, Custom-Header-B, Custom-Header-A
```

#### Access-Control-Max-Age

Preflight Request의 결과가 캐쉬에 얼마나 오래동안 남아있는지 나타낸다.

```
Access-Control-Max-Age: <delta-seconds>
```

#### Access-Control-Allow-Credential

Request with Credential 방식이 사용될 수 있는지를 지정한다.

```
Access-Control-Allow-Credentials: true | false
```

#### Access-Control-Allow-Methods

예비 요청에 대한 Response Header에 사용되며, 서버의 리소스에 접근할 수 있는 HTTP Method 방식을 지정한다.

```
Access-Control-Allow-Metehods: <method>
```
GET,POST,DELETE,PATCH 등등이 존재한다.

#### Access-Control-Allow-Headers

예비 요청에 대한 Response Header에 사용되며, 본 요청에서 사용할 수 있는 HTTP Header를 지정한다.

```
Access-Control-Allow-Headers: <field-name>
```
`Content-Type`, `Accept-Encdoing`, `X-CSRF-Token`, `Authorization` 등이 있다.

<br>

---

### CORS 관련 HTTP Request Headers
클라이언트가 서버에 CROS 요청을 보낼 때 사용하는 헤더로, 브라우저가 자동으로 지정하며, XMLHttpReqeust를 사용하는 프로그래머가 직접 지정해 줄 필요가 없다.


#### Origin
Cross-Site 요청을 날리는 요청 도메인 URI를 나타내며, access control이 적용되는 모든 요청에 `Origin` 헤더는 반드시 포함된다.

```
Orgin: <origin>
```
`<origin>`은 서버 이름(포트 포함)만 포함되며 경로 정보는 포함되지 않는다.

#### Access-Control-Request-Method
예비 요청을 보낼 때 포함되어, 본 요청에서 어떤 HTTP Method를 사용할 지 서버에게 알려준다.

```
Access-Control-Request-Method: <Method>
```
`<method>`는 POST,GET,DELETE 등이 포함될 수 있다.

#### Access-Control-Request-Headers
에비 요청을 보낼 때 포함되어, 본 요청에서 어떤 HTTP Header를 사용할 지 서버에게 알려준다.

```
Access-Control-Request-Headers: <field-name>
```
`Authorization`,`Content-Type` 등이 있다.

<br><br><br>
참조 : https://brownbears.tistory.com/336






