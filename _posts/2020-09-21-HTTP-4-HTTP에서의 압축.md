---
title: HTTP 4. HTTP에서의 압축
tags: HTTP
article_header:
  type: cover
  image: 
      src: 
---

### 개요
HTTP 압축은 전송 속도와 대역폭 이용을 개선하기 위해 웹 서버와 웹 브라우저에 빌드되는 기능이다.
HTTP 압축은 웹 사이트의 성능 개선에 있어서 아주 중요한 기능이며, 많게는 70% 이상의 사이즈 축소로 용량을 줄여주는 효과가 있다.
수년 간, 클라이언트와 서버가 발전된 압축 알고리즘을 제공해왔기에 웹 개발자들은 따로 압축 메커니즘을 구현할 필요 없이, 서버가 잘 구성되어 있는지만 확인하면 된다. 

압축은 3개의 서로 다른 계층에서 이뤄진다.

* 먼저 일부 파일 형식이 최적화된 특유의 방법으로 압축
* 그 후 HTTP 계층에서 일반적인 암호화가 발생한다. 이 때, 리소스는 끝단 간에 압축되어 전송된다.
* 마지막으로 HTTP 커넥션의 두 노드 사이의 커넥션 계층에서 압축이 정의된다.

---

### 파일 포맷 압축

어떤 자료를 디지털화 할 때 해당 자료의 엔트로피만큼의 용량이 있으면 충분하다. 그러나 대부분의 경우, 어떤 자료를 디지털 자료로 변환할 때, 파일 관리의 편리성 등을 높이기 위해 필요 이상의 용량을 소모하는 경우가 많다. (자료 저장 시 이론상 가능한 최소의 용량만 사용할 경우 자료를 저장할 때마다 새로운 저장 방식을 골라야 하므로 파일 관리가 매우 힘들어진다.) 텍스트 자료가 약 60% 를 필요 이상으로 소모하며, 오디오나 비디오 파일 같은 미디어 타입은 더 많은 용량을 차지한다.
이를 해결하기 위해 최적화된 압축 알고리즘이 만들어졌다. 

압축 알고리즘은 크게 두 가지로 나눌 수 있다.

1. 무손실 압축 : 무손실 압축은 원본의 데이터를 조금도 훼손하지 않고 용량을 줄이는 방식이다. 이미지 파일 중에서 `gif`와 `png` 확장자가 무손실 압축 알고리즘을 사용한다. 

2. 손실 압축 : 사진, 음악, 동영상 등 주로 멀티미디어 데이터에서 인간이 지각하기 힘든 범위의 데이터를 버리고 압축하는 방법을 사용하는 포맷. 멀티미디어 데이터를 화질, 음질 등에서 좀 손해를 보더라도 용량만 줄이면 된다는 생각으로 만들어진 포맷이다. 멀티미디어 데이터에서 인간이 지각하기 힘든 영역을 삭제하고 압축을 하기 때문에 실제로 데이터가 손실되었다는 것은 인지하기 힘든 반면, 파일의 크기는 1/5~1/10까지 줄어들기 때문에 무손실 압축에 비해서 저장 장치와 네트웍 비용을 덜 들이면서 고화질, 고음질 데이터를 보관 및 전송하는게 가능해진다.

일반적으로는 손실 압축이 무손실 압축에 비해서 효율적이다.

#### 종단 간 압축

압축 알고리즘 중 웹사이트에서 가장 크게 효율을 보이는 압축은 종단 간 압축이다. 종단 간 압축은 서버에서 처리되며 클라이언트에 도달할 때까지 압축된 데이터에 대해 어떤 간섭도 허용하지 않는다.
클라이언트에 도달하고 나서야 압축을 푸는 방식이다. 

모든 브라우저와 서버는 종단 간 압축을 지원한다. 종단 간 압축 사용 시, 개발자가 지정해줘야 하는 유일한 부분은 '어떤 압축 알고리즘을 사용할 것인가' 이다. 종단 간 압축에서는 보통 텍스트에 최적화된 압축 알고리즘을 사용하며, 이를 위해 보통 `gzip` 과 `br`을 사용한다. 

사용할 압축 알고리즘을 정하기 위해 서버와 클라이언트는 Content-Negotation 이라는 것을 사용한다. 
>Content-Negotiation?
>>사용자 에이전트(브라우저)가 사용자에게 가장 적합한 인코딩 방식을 선정하는 것

브라우저는 Accept-Encoding 헤더에 브라우저가 지원하는 압축 알고리즘들과 이 알고리즘들의 우선 순위 정보를 담아 서버로 보낸다. 이를 받은 서버는 Accept-Encoding 헤더에 담긴 정보를 바탕으로 응답으로 보낼 body를 압축한다. 이 때 서버는 사용한 압축 알고리즘을 응답과 함께 명시해준다. 

유의해야 하는 점으로 Content-Negotiation이 인코딩 방식을 택하는데 사용되었기 때문에 응답에는 Accept-Encoding을 담은 vary 헤더가 최소 1개는 있어야 한다는 것이다.

### Hop-by-hop 압축

홉 바이 홉 압축은 종단 간 압축과 매우 비슷하지만 뚜렷하게 다른 점이 하나 있다. 압축이 서버에서 이뤄지지 않고 클라이언트와 서버 사이의 경로에 위치한 노드들(장치들) 간에 압축이 이루어진다는 것이다.

홉 바이 홉 압축을 사용하기 위해서는 종단 간 압축에서 Content-Negotiation을 사용한 것과 비슷한 방식을 사용해야 한다. 요청을 전송하는 노드(장치)가 다른 장치에게 자신이 TE헤더를 사용한다는 것을 알려야 하며, 요청을 받은 노드(장치)는 알맞는 압축 알고리즘을 선택하고 압축을 진행한 뒤, Transfer-Encoding 헤더를 이용해 어떤 압축 알고리즘을 사용했는지 명시해야 한다는 것이다.

사실, 홉 바이 홉 압축 방식은 주로 사용하는 압축 방식은 아니다. 


>홉?
>>홉은 IP 주소를 가진 장소를 말한다.

---

참조 : <br> 
* https://developer.mozilla.org/ko/docs/Web/HTTP/Compression
* https://chorizzori.tistory.com/78
* https://namu.wiki/w/%EB%AC%B4%EC%86%90%EC%8B%A4%20%EC%95%95%EC%B6%95%20%ED%8F%AC%EB%A7%B7
