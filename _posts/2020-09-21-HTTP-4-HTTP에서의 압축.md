---
title: HTTP 4. HTTP에서의 압축
tags: HTTP
article_header:
  type: cover
  image: 
      src: 
---

### 개요
HTTP 압축은 전송 속도와 대역폭 이용을 개선하기 위해 웹 서버와 웹 브라우저에 빌드되는 기능이다.
HTTP 압축은 웹 사이트의 기능 개선에 있어서 아주 중요한 기능이며, 많게는 70% 까지도 사이즈를 축소시킬 수 있다.
수년 간, 압축 알고리즘은 계속해서 발전해왔고 클라이언트와 서버에 의해 꾸준히 새로운 기술들이 지원되고 있다. 

이 때문에 웹 개발자들은 따로 압축 메커니즘을 구현할 필요 없이, 서버가 잘 구성되어 있는지만 확인하면 된다. 
압축은 3개의 서로 다른 계층에서 인어난다.

> SPDY? 
>> 웹 컨텐츠를 전송할 목적으로 구글이 개발한 비표준 개방향 네트워크 프로토콜.

이후 2012년, IETF에서 HTTP/2의 초안으로 SPDY의 구조를 채택함으로써 현재의 HTTP/2의 구조와 기능이 SPDY와 유사하다.
표준에서 TLS를 요구하는 것은 아니지만, SPDY에서 TLS를 요구했던 여파로 인해 모든 메이저 브라우저들이 TLS 없이는 HTTP/2를 지원하지 않고 있다.

> TLS? 
>> Transport Layer Security. 인터넷에서 정보를 암호화하여 송수신하는 프로토콜. SSL이라는 용어로 불리운다. HTTPS 연결이 대표적인 예시.

---

### HTTP/1.1에서의 개선점

#### Head of line blocking (HOL)

HTTP/1.1 까지는 한 번에 파일 하나씩 밖에 못 보냈다. 그러다보니 특정 파일의 로딩이 늦어지면 다른 파일까지 줄줄이 로딩이 늦어지는 병목 현상이 생겨났다.
그래서 여러 파일을 한꺼번에 병렬 전송을 하는 식으로 로딩 시간을 줄이는 방법을 이용한다.

#### Header Comparison

이전까지는 HTTP 헤더가 평문이었지만, HTTP/2에서는 Header Table과 Huffman Encoding 기법을 사용하여 헤더 용량 대비 처리 효율성을 높인다. 이를 HPACK 압축방식이라 부른다.

HTTP/1.x의 경우 두개의 요청 Header에 중복값이 존재해도 그냥 중복 전송한다. 하지만 HTTP/2 에선 Header에 중복값이 존재하는 경우 Static/Dynamic Header Table 개념을 사용하여 중복 Header를
검출하고 중복된 Header는 index값만 전송하고 중복되지 않은 Header 정보의 값은 Huffman Encoding 기법으로 인코딩 처리하여 전송한다.

#### Server Push

서버는 클라이언트의 요청에 대해 요청하지도 않은 리소스를 마음대로 보내줄 수도 있다.

클라이언트가 HTML 문서를 요청했고 해당 HTML에 여러 개의 리소스(CSS,Image...)가 포함되어 있는 경우 HTTP/1.x 에서는 요청한 HTML 문서를 수신한 후, HTML 문서를 해석하면서 필요한 리소스를 재요청했다. 그러나 HTTP/2 에서는 Server Push 기법을 통해 클라이언트가 요청하지 않은 리소스(HTML에 포함된 리소스)를 push 해주는 방법으로 클라이언트의 요청을 최소화 해서 성능 향상을 이끌어낸다.
이를 Push_Promise 라고 부르며 클라이언트는 서버가 전송한 리소스에 대해서는 재요청을 하지 않는다.

#### Stream Prioritization

클라이언트가 요청한 HTML 문서 안에 CSS 1개와 Image 2개가 존재하고 이를 클라이언트가 각각 요청하고 난 후 Image 파일보다 CSS 파일의 수신이 늦어지는 경우 브라우저의 렌더링이 늦어지는 문제가 발생하는데 HTTP/2의 경우 리소스 간 의존관계(우선 순위)를 설정하여 이런 문제를 해결할 수 있다.

---

### 결론

일반적으로 HTTP/2를 사용하면 웹 응답 속도가 HTTP/1.1에 비해 15~50% 향상 된다고 한다. 아직까지도 많은 사이트들이 HTTP/1.1만 지원하고 있다. 하지만 우리가 모르는 새에 많은 서비스들이
이미 HTTP/2를 적용하고 있고 우리는 사용하고 있다. 모바일 시대가 다가오고 있다. 모바일 디바이스에서 구동되는 대부분의 브라우저는 HTTP/2를 지원하고 있고 개발자들은 웹서버에 HTTP/2 지원 모듈을
설치하거나 HTTP/2를 지원하는 웹서버로의 변경을 통해 사용자에게 조금 더 나은 서비스 이용 환경을 제공해 줄 수 있다. 물론 HTTP/2 도입을 위한 작업은 자칫 서비스 장애를 있기에 신중히 판단해야겠지만, 효율을 생각하면 충분히 고려할만한 작업이라 판단할 수 있겠다.

---
참조 : <br> 
* https://ko.wikipedia.org/wiki/HTTP_%EC%95%95%EC%B6%95
* https://developer.mozilla.org/ko/docs/Web/HTTP/Compression
