---
title: HTTP (5) HTTP 조건부 요청
tags: HTTP
article_header:
  type: cover
  image: 
      src: 
---

### 개요
HTTP에는 조건부 요청이라는 개념이 있다. 조건부 요청은 리소스가 변경된 경우에만 그 사본을 요청하는 기능이다. \
이를 통해 업로드 및 다운로드 시에 이뤄지는 불필요한 시간 및 공간 자원 소요를 막을 수 있다.

---

### 원리

HTTP 조건부 요청은 평범한 HTTP 요청 메시지이지만, 특정 조건이 참인 경우에만 수행된다. 조건부 요청은 If-로 시작하는 조건부 헤더를 포함한다. \
만약 조건이 참이 아니면 서버는 HTTP 에러 코드를 돌려 보낸다. 

요청에 사용된 조건부 헤더와 메소드에 따라 동작이 달라진다.

* 페이지를 가져오기 위한 `GET`과 같은 안전한(safe) 메서드 사용 시, 조건부 요청은 연오직 연관이 있는 경우에만 회신하므로 대역폭을 아낄 수 있다.
* 페이지를 업로드하기 위한 `PUT`과 같은 불안정한(unsafe) 메서드 사용 시, 조건부 요청은 오직 원본 파일이 서버에 있는 파일과 동일할 때만 업로드가 진행될 수 있게 한다.

---

### 검사기

모든 조건부 요청은 서버에 있는 자료가 특정 버젼과 일치하는지 검사한다. 이렇게 검사하기 위해서는 조건부 요청에 자료의 버젼이 명시되어 있어야 한다. \
모든 자료를 서로 세세하게 비교하는 것은 비효율적이기 때문에, 요청에는 버젼이 명시되어 있어야 한다. \
이렇게 명시하는 것을 `검사기(Validator)`라고 부르며 검사기에는 두 종류가 있다.

* 문서의 최종 수정 날짜를 검사하는 `last-modified`
* 각 버젼을 나타내는 특수 문자열인 `entity tag`

버젼 간의 비교는 까다로운 편이다. 그래서 상황에 따라 비교하는 방법이 두 개로 나뉜다.

* 강한 검사(Strong Validator) : 자료를 다시 내려받는 상황과 같이 세세한 비교가 필요할 때 사용되는 방법이다.
* 약한 검사(Weak Validator) : 두 개의 리소스가 서로 같은 지 브라우저가 판단해야 할 때 사용한다. 아주 사소한 차이가 있을 때 사용하는 방법이다.

`Last-Modified`와 `ETag(Entity Tag)` 모두 위의 두가지 방법을 사용할 수 있다. 강한 검사가 표준으로 사용되며, 약한 검사를 사용해도 될 때를 구분하여 약한 검사를 진행한다.

HTTP 조건 요청에 포함되는 헤더와 관련 검사기는 다음과 같이 정리할 수 있다.

|요청 유형|검사기|설명|
|---|---|---|
|If-Modified-Since|Last-Modified|지난번 Last-Modified 응답 헤더에 들어 있던 시각에 마지막으로 수정된 버전이 더 이상 최신 버전이 아니라면, 리소스의 사본을 보내라|
|If-Unmodified-Since|Last-Modified|지난번 Last-Modified 응답 헤어데 들어 있던 시각에 마지막으로 수정된 버전에서 변한 것이 없다면, 리소스의 사본을 보내라.
|If-Match|ETag|지난번 ETag 응답 헤더에 들어있었던 것과 현재 요청에 대한 응답으로 오는 엔티티 태그가 같다면, 리소스의 사본을 보내라|
|If-None-Match|ETag|지난번 ETag 응답 헤더에 들어있었던 것과 현재 요청에 대한 응답으로 오는 엔티티 태그가 다르다면, 리소스의 사본을 보내라|

---

참조 : <br> 
* https://developer.mozilla.org/ko/docs/Web/HTTP/Compression
* https://chorizzori.tistory.com/78
* https://namu.wiki/w/%EB%AC%B4%EC%86%90%EC%8B%A4%20%EC%95%95%EC%B6%95%20%ED%8F%AC%EB%A7%B7
