---
title: HTTP (6) HTTP 컨텐츠 협상
tags: HTTP
article_header:
  type: cover
  image: 
      src: 
---

### 개요

컨텐츠 협상은 클라이언트가 처리할 수 있는 내용과 서버가 처리할 수 있는 내용을 기반으로 클라이언트에 반환할 콘텐츠 유형을 결정하는 방법이다. \
클라이언트가 어떤 타입의 데이터를 반환하기를 원하는 지, 미디어 파일은 어떤 형태로 반환해야 하는지 여부, 지원되는 압축 유형 등을 결정하는 데 사용할 수 있다. \

---

### 원칙

클라이언트는 URL을 통해서 데이터를 요청한다. 서버는 요청 받은 특정 형태의 데이터를 응답으로 전송한다. \
서버가 지니는 모든 데이터는 각각의 형태에 따라 (text냐 JSON이냐, jpg냐 png냐 등) 특정 URL을 가진다. \

URL을 통해 데이터가 요청되었을 때, 해당 데이터의 타입과 유형을 선택하는 방법은 컨텐츠 협상에 의해 결정되며 \
클라이언트와 서버 간의 협상은 다음 두 개의 방법을 통해 이뤄진다.

1. 클라이언트가 보내는 특정 HTTP 헤더를 이용하는 방법. 가장 보편적인 방법이다.
2. 서버에 의해 전달되는 상태 코드(300,406)를 사용하는 방법. Fallback Mechanism으로써 사용된다.
<br/>

> Fallback Mechanism?
>> 시스템 상에서 오류가 발생하거나 제대로 동작하지 않을 때, 이에 대처하는 기능 또는 동작

---

### 서버 주도 Content Negotiation

HTTP/1.1 표준은 서버 주도 컨텐츠 협상을 시작하는 표준 헤더 목록인 `Accept`, `Accept-Charset`, `Accept-Encoding`, `Accept-Language` 를 정의하고 있다. \
`User-Agent` 또한 컨텐츠 협상을 위해 사용할 수 있으나 좋은 방법으로 꼽히지는 않는다. \
서버는 컨텐츠 협상에 사용될 헤더를 가리키기 위해 `Vary` 헤더를 사용하며, 이로 인해 캐시 최적화가 잘 이루어진다.

<br>

#### `Accept` 헤더

`Accept` 헤더는 브라우저가 처리하고자 하는 미디어 데이터의 MIME 타입을 나열한다. \
MIME 타입들은 쉼표로 각각 구분되어 있으며, 품질 인자와 함께 나열된다.
<br>

>품질 인자?
>>각 MIME 타입에 대해 브라우저에서 선호하는 정도. 품질 인자는 MIME 타입 뒤에 ;q={weight} 형식으로 붙는다.

|User Agent|Value|
|---|---|
|Safari,Chrome|`text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8`|
|IE8|`image/jpeg, application/x-ms-application, image/gif, application/xaml+xml, image/pjpeg, application/x-ms-xbap, application/x-shockwave-flash, application/msword, */*`|

<br>

#### `Accept-Charset` 헤더

브라우저가 어떤 문자 인코딩 방식을 지원하는 지 서버에게 알려주는 헤더. \
현재는 UTF-8이 보편화되어 거의 쓰이지 않는 헤더이다. 이미 IE8, Safari 5, Opera 11 등에서는 이 헤더를 폐기했다.

<br>

#### `Accept-Encoding` 헤더

브라우저에서 압축할 수 있는 컨텐츠 인코딩을 나타낸다. `Accept-Encoding`도 품질 인자를 지닌다. \
`Accept-Encoding`이 설정되어 있지 않다면 기본값인 identity로 요청을 넣는다. `Accept-Encoding`이 명시되어 있지 않아도 identity만은 항상 수용 가능하다고 여겨지기 때문이다. \

<br>

#### `Accept-Language` 헤더

브라우저가 선호하는 언어를 가리킬 때 사용한다. `Accept-Language` 헤더 또한 품질 인자와 함께 나열된다.

<br>

#### `User-Agent` 헤더

위에서 언급한 것처럼, 컨텐츠 협상을 위해 `User-Agent` 헤더를 이용하는 것은 권장되지 않는다. \
웹 브라우저에 따라 다른 서비스를 제공한다는 의미가 되므로 사용자의 브라우저나 철학에 상관 없이 누구나 사용 가능하다는 웹의 철학에 위반되기 때문이다.

<br>

#### `Vary` 헤더
여타 `Accept-` 헤더들과 다르게 `Vary` 헤더는 요청이 아닌 응답으로 전달된다. \
`Vary` 헤더는 서버 주도 컨텐츠 협상 중에 서버에 의해 사용되는 헤더들의 목록을 나타낸다. \
`Vary` 헤더는 HTTP/1.1에서 추가되었으며 이를 사용함으로써 사용자가 별다른 조치를 취하지 않아도 캐시가 적절하게 동작한다. \
`Vary` 헤더는 다음과 같이 사용한다.

* Vary : *

각 요청에 대해 유일하며 캐시할 수 업는 요청으로 간주하게 만드는 방법.

* Vary : <Header-Name>, <Header-Name>....

헤더 이름은 쉼표로 구분되며, 캐시된 응답을 향후 요청에서 사용할 수 있는지 여부를 결정할 때 사용한다.

---

### 브라우저 주도 Content Negotiation

사용 가능한 데이터를 포함하는 페이지를 서버가 회신하면 브라우저가 사용할 데이터를 선택하는 협상 방식이다.

브라우저 주도 Content Negotiation은 거의 사용되지 않는다.

---

참조 : <br> 
* https://developer.mozilla.org/ko/docs/Web/HTTP/Content_negotiation
* https://chorizzori.tistory.com/79
* http://ci4doc.cikorea.net/incoming/content_negotiation.html
