---
title: JavaScript (14) 옵셔널 체이닝 '?.'
tags: JavaScript
article_header:
  type: cover
  image:
---

### 개요

> 옵셔널 체이닝은 추가된 지 얼마 안된 문법으로 구식 브라우저에서는 작동하지 않을 수도 있다.

옵셔널 체이닝(optional chaining) ?.을 사용하면 프로퍼티가 없는 중첩 객체에 에러 없이 안전하게 접근할 수 있다.

---

### 옵셔널 체이닝이 필요한 이유

사용자가 여러 명 있는데 그중 몇 명은 주소 정보를 가지고 있지 않다고 가정해보자. 이럴 때 user.address.street를 사용해 주소 정보에 접근하면 에러가 발생한다.

``` javascript
let user = {}; // 주소 정보가 없는 사용자

alert(user.address.street); // TypeError: Cannot read property 'street' of undefined
```

또한 페이지에 존재하지 않는 요소에 접근해 요소의 정보를 가져오려 할 때도 오류가 발생한다.

``` javascript
// querySelector(...) 호출 결과가 null인 경우 에러 발생
let html = document.querySelector('.my-element').innerHTML;
```

`?.` 문법이 추가되기 전엔 이런 문제들을 해결하기 위해 `&&` 연산자를 사용했다.

``` javascript
let user = {}; // 주소 정보가 없는 사용자

alert( user && user.address && user.address.street ); // undefined, 에러가 발생하지 않습니다.
```

이렇게 AND를 연결해서 사용하면 코드가 아주 길어지게 된다.

---

### 옵셔널 체이닝의 등장

`?.`은 `?.`'앞’의 평가 대상이 `undefined`나 `null`이면 평가를 멈추고 `undefined`를 반환합니다.

아래 예시는 옵셔널 체이닝을 사용해 user.address.street에 접근하는 모습이다.

``` javascript
let user = {}; // 주소 정보가 없는 사용자

alert( user?.address?.street ); // undefined, 에러가 발생 X
```

`user?.address`로 주소를 읽으면 아래와 같이 `user` 객체가 존재하지 않더라도 에러가 발생하지 않는다.

``` javascript
let user = null;

alert( user?.address ); // undefined
alert( user?.address.street ); // undefined
```

`?.`은 `?.` ‘앞’ 평가 대상에만 동작되고, 확장은 되지 않는다.

> **옵셔널 체이닝은 남용해서는 안된다.**
>> `?.`는 존재하지 않아도 괜찮은 대상에만 사용한다. 위 예시에서 논리 상 `user`는 필수적이지만 `address`는 필수값이 아니다. 그러므로 `user.address?.street`로 쓰는 것이 바람직함.

> **`?.`앞의 변수는 꼭 선언되어 있어야 함**
>> 변수가 선언되어 있지 않으면 평가 시 에러 발생

---

### 단락 평가

`?.`는 왼쪽 평가대상에 값이 없으면 즉시 평가를 멈춘다. 이런 평가 방법을 *단락 평가(short-circuit)*라고 한다.

그렇기 때문에 함수 호출을 비롯한 ?. 오른쪽에 있는 부가 동작은 ?.의 평가가 멈췄을 때 더는 일어나지 않는다.

---

### ?.()와 ?.[]

`?.`은 연산자가 아니라 함수나 대괄호와 함께 동작하는 특별한 문법 구조체(syntax construct)이다.

아래 예시에서 한 객체엔 메서드 admin이 있지만 다른 객체엔 없는 상황이다.

``` javascript
let user1 = {
  admin() {
    alert("관리자 계정입니다.");
  }
}

let user2 = {};

user1.admin?.(); // 관리자 계정입니다.
user2.admin?.();
```

`user1`엔 `admin`이 정의되어 있기 때문에 메서드가 제대로 호출되었다. 
반면 `user2`엔 `admin`이 정의되어 있지 않았음에도 불구하고 메서드를 호출하면 에러 없이 그냥 평가가 멈추었다.

`?.`대신 대괄호 `[]`를 사용해 객체 프로퍼티에 접근하는 경우엔 `?.[]`를 사용할 수도 있다.

``` javascript
let user1 = {
  firstName: "Violet"
};

let user2 = null; // user2는 권한이 없는 사용자라고 가정해봅시다.

let key = "firstName";

alert( user1?.[key] ); // Violet
alert( user2?.[key] ); // undefined

alert( user1?.[key]?.something?.not?.existing); // undefined
```

`?.`은 delete와 조합해 사용하는 것도 가능하다.

``` javascript
delete user?.name; // user가 존재하면 user.name을 삭제합니다.
```

---

참조 : <br>
* https://ko.javascript.info/optional-chaining
