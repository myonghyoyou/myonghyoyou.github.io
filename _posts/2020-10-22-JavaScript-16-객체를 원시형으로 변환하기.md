---
title: JavaScript (16) 객체를 원시형으로 변환하기
tags: JavaScript
article_header:
  type: cover
  image:
---

### 개요

1. 객체는 논리 평가(boolean) 시 단 하나의 예외 없이 `true`를 반환한다. 따라서 객체는 숫자형이나 문자형으로만 형 변환이 일어난다.
2. 숫자형으로의 형 변환은 객체끼리 빼는 연산을 할 때나 수학 관련 함수를 적용할 때 발생한다. 객체 Date끼리 차감하면(date1 - date2) 두 날짜의 시간 차이가 반환된다.
3. 문자형으로의 형 변환은 대개 alert(obj)같이 객체를 출력하려고 할 때 일어난다.

---

### ToPrimitive

특수 객체 메서드를 사용하면 숫자형이나 문자형으로의 형 변환을 원하는 대로 조절할 수 있다.

객체 형 변환은 세 종류로 구분되는데, `hint`라 불리는 값이 구분 기준이 된다.
> `hint`? 목표로 하는 자료형

#### `"String"`

alert 함수같이 문자열을 기대하는 연산을 수행할 때는(객체-문자형 변환), hint가 `string`이 된다.

``` javascript
// 객체를 출력하려고 함
alert(obj);

// 객체를 프로퍼티 키로 사용하고 있음
anotherObj[obj] = 123;
```

#### `"number"`

수학 연산을 적용하려 할 때(객체-숫자형 변환), hint는 `number`가 된다.

``` javascript
// 명시적 형 변환
let num = Number(obj);

// (이항 덧셈 연산을 제외한) 수학 연산
let n = +obj; // 단항 덧셈 연산
let delta = date1 - date2;

// 크고 작음 비교하기
let greater = user1 > user2;
```

#### `"default"`

연산자가 기대하는 자료형이 ‘확실치 않을 때’ hint는 default가 된다. 

아주 드물게 발생하는 경우로, 이항 덧셈 연산자 `+`는 문자형끼리 합치는 것도 가능하고 숫자형끼리의 합 연산도 가능하기에 `+`의 인수가 객체일 경우에 hint는 `default`가 된다.

동등 연산자 `==` 사용해 객체-문자형, 객체-숫자형, 객체-심볼형끼리 비교할 때도, 객체를 어떤 자료형으로 바꿔야 할지 확신이 안 서므로 hint는 `default`가 된다.

``` javascript
// 이항 덧셈 연산은 hint로 `default`를 사용한다.
let total = obj1 + obj2;

// obj == number 연산은 hint로 `default`를 사용한다.
if (user == 1) { ... };
```

비교 연산자인 `<`, `>` 역시 피연산자에 문자형과 숫자형 모두를 허용하는데, 그럼에도 불구하고 hint를 `number`로 고정한다. 

> `boolean` hint는 존재하지 않는다. 모든 객체는 `true`로 평가되기 때문이다.

---

### Symbol.toPrimitive

자바스크립트엔 `Symbol.toPrimitive`라는 내장 심볼이 존재하는데, 이 심볼은 아래 예시처럼 목표로 하는 자료형(hint)을 명명한다.

``` javascript
obj[Symbol.toPrimitive] = function(hint) {
  // 반드시 원시값을 반환해야 한다.
  // hint는 "string", "number", "default" 중 하나가 될 수 있다.
};
```

아래 예시는 `user` 객체에 객체-원시형 변환 메서드 `obj[Symbol.toPrimitive](hint)`를 구현한 모습이다.

``` javascript
let user = {
  name: "John",
  money: 1000,

  [Symbol.toPrimitive](hint) {
    alert(`hint: ${hint}`);
    return hint == "string" ? `{name: "${this.name}"}` : this.money;
  }
};

// 데모:
alert(user); // hint: string -> {name: "John"}
alert(+user); // hint: number -> 1000
alert(user + 500); // hint: default -> 1500
```

위 예시에서 `user`는 hint에 따라 문자열로 변환되기도 하고 숫자로 변환되기도 한다.

---

### toString과 valueOf

`toString`과 `valueOf`를 이용하면 구식이긴 하지만 형 변환을 직접 구현할 수 있다.

객체에 `Symbol.toPrimitive`가 없으면 자바스크립트는 아래 규칙에 따라 `toString`이나 `valueOf`를 호출한다.

* hint가 'string’인 경우: toString -> valueOf 순(toString이 있다면 toString을 호출, toString이 없다면 valueOf를 호출함)
* 그 외: valueOf -> toString 순

이 메서드들은 반드시 원시값을 반환해야한다. `toString`이나 `valueOf`가 객체를 반환하면 그 결과는 무시된다.

일반 객체는 기본적으로 `toString`과 `valueOf`에 적용되는 다음 규칙을 따른다.

`toString`은 문자열 `"[object Object]"`을 반환한다.
`valueOf`는 객체 자신을 반환합니다.

예시:
``` javascript
let user = {name: "John"};

alert(user); // [object Object]
alert(user.valueOf() === user); // true
```

위와 같은 이유로 `alert`에 객체를 넘기면 `[object object]`가 출력된다.

`valueOf`는 자기 자신을 반환하기 때문에 그 결과가 무시된다. (객체를 반환하면 결과가 무시됨)

아래 예시는 `toString`과 `valueOf`를 통해 `Symbol.toPrimitive`를 이용한 예시와 동일하게 작동하게 한 모습이다.

``` javascript
let user = {
  name: "John",
  money: 1000,

  // hint가 "string"인 경우
  toString() {
    return `{name: "${this.name}"}`;
  },

  // hint가 "number"나 "default"인 경우
  valueOf() {
    return this.money;
  }

};

alert(user); // toString -> {name: "John"}
alert(+user); // valueOf -> 1000
alert(user + 500); // valueOf -> 1500
```

모든 형 변환을 한 곳에서 처리해주어야 할 때는 `toString`만 정의한다.

``` javascript
let user = {
  name: "John",

  toString() {
    return this.name;
  }
};

alert(user); // toString -> John
alert(user + 500); // toString -> John500
```

객체에 `Symbol.toPrimitive`와 `valueOf`가 없으면, `toString`이 모든 형 변환을 처리한다.

---

### 반환 타입

위에 명시한 3개의 메서드는 'hint'에 명시된 자료형으로의 형 변환을 보장하지는 않는다.

`toString`이 항상 문자열을 반환한다는 보장도 없고, `Symbol.toPrimitive`의 hint가 `number`일 때 꼭 숫자형 자료를 반환한다는 보장도 없다.

단지 객체가 아닌 원시형을 반환한다는 사실만이 보장된다.

---

### 추가 형 변환

곱셈을 해주는 연산자 `*`는 피연산자를 숫자형으로 변환시킨다.

객체가 피연산자일 때는 아래와 같은 단계를 거쳐 형 변환이 발생한다.

1. 객체가 원시형으로 변화. 변환 규칙은 위에서 설명한대로.
2. 변환 후 원시값이 원하는 형이 아닌 경우엔 또 다시 형 변환이 일어난다.

예시:
```javascript
let obj = {
  // 다른 메서드가 없으면 toString에서 모든 형 변환을 처리한다.
  toString() {
    return "2";
  }
};

alert(obj * 2); // 4, 객체가 문자열 "2"로 바뀌고, 곱셈 연산 과정에서 문자열 "2"는 숫자 2로 변경된다.
// hint로 `number`가 들어갔기 때문
```

그러나 이항 덧셈 연산은 위와 같은 상황에서 문자열을 연결한다.

``` javascript
let obj = {
  toString() {
    return "2";
  }
};

alert(obj + 2); // 22("2" + 2), 문자열이 반환되기 때문에 문자열끼리의 병합이 일어난다.
```

---

참조 : <br>
* https://ko.javascript.info/object-toprimitive
